define(["esri/request","esri/graphicsUtils","esri/graphic","esri/symbols/SimpleFillSymbol","dojo/_base/array","dojo/on"],function(){"use strict";function u(){n=$("<div>").sidebar();app.mapContainer.append(n);r=n.data("bs.sidebar");var t=$($("#tmplPanelButton").render({Id:"BASE",Title:"BASE",Icon:"glyphicon glyphicon-leaf",Label:"BASE"}));t.removeClass("toggle-panel").removeAttr("data-target").click(function(){r.show()});$(app.mainToolbar).append(t)}function f(u,f){function p(){$.each(app.operationalMap.visibleLayers,function(){})}for(var o,h,c,e,l,a,v,y=$.templates('<tr><td style="vertical-align:top; padding-left:5px;"><input type="checkbox" class="check_vincolo" data-id="{{:layer.id}}" /><\/td><td style="vertical-align:top; padding-left:5px;">{{:layer.name}}<\/td><\/tr>'),s=0;s<f.length;s++)o=f[s],o.parentLayerId==u&&t.push({layer:o,title:o.name});i=app.visibleLayers.slice();t.sort(function(n,t){var i=n.layer.name.toUpperCase(),r=t.layer.name.toUpperCase();return i>r?1:r>i?-1:0});h=$("<table>");c=$("<tbody>");h.append(c);$.each(t,function(){c.append(y.render(this))});e=$('<div style="position:fixed; bottom: 0;overflow:auto; top: 110px; margin-bottom: 50px; width:275px; background-color: #fff; border: 1px solid #eee;">');h.appendTo(e);l=$('<button type="button" class="btn btn-success btn-sm" style="margin-right:5px;">Aggiorna Mappa<\/button>');l.click(function(){event.preventDefault();var n=i.slice();app.visibleLayersBase=[];e.find(".check_vincolo:checked").each(function(){n.push($(this).data("id"));app.visibleLayersBase.push($(this).data("id"))});$.each(app.visibleLayersVincoli,function(t,i){n.push(i)});app.operationalMap.setVisibleLayers(n)});a=$('<button type="button" class="btn btn-danger btn-sm" style="margin-right:5px;">Spegni tutto<\/button>');a.click(function(){event.preventDefault();e.find(".check_vincolo").each(function(){$(this).prop("checked",!1)});var n=i.slice();app.operationalMap.setVisibleLayers(n);app.legend.refresh()});v=$("<div>");v.append(l).append(a).append(e);r.setContent("<p>BASE<br/><small>",v);n.on("show.bs.sidebar",function(){p()})}var t=[],i=[],r=null,n=null;return{inizializza:function(n,t){u();f(n,t)}}});
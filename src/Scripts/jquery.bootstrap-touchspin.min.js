(function(n){"use strict";function u(n,t){return n+".touchspin_"+t}function r(t,i){return n.map(t,function(n){return u(n,i)})}var i=0,t=0;n.fn.TouchSpin=function(u,f,e){if(u==="destroy"){this.each(function(){var t=n(this),i=t.data();n(document).off(r(["mouseup","touchend","touchcancel","mousemove","touchmove","scroll","scrollstart"],i.spinnerid).join(" "))});return}var o={min:0,max:100,initval:"",replacementval:"",step:1,decimals:0,stepinterval:100,forcestepdivisibility:"round",stepintervaldelay:500,booster:!0,boostat:10,maxboostedstep:!1,mousewheel:!0,buttondown_class:"btn btn-default",buttonup_class:"btn btn-default",buttondown_txt:"-",buttonup_txt:"+"},s={min:"min",max:"max",initval:"init-val",replacementval:"replacement-val",step:"step",decimals:"decimals",stepinterval:"step-interval",forcestepdivisibility:"force-step-divisibility",stepintervaldelay:"step-interval-delay",booster:"booster",boostat:"boostat",maxboostedstep:"max-boosted-step",mousewheel:"mouse-wheel",buttondown_class:"button-down-class",buttonup_class:"button-up-class",buttondown_txt:"button-down-txt",buttonup_txt:"button-up-txt"};return this.each(function(){function ot(){l.data("alreadyinitialized")||(l.data("alreadyinitialized",!0),i+=1,l.data("spinnerid",i),ct(),vt(),st(),k(),yt(),pt())}function st(){h.initval!==""&&(t=h.initval,nt())}function ht(n){at(n);k()}function ct(){h=n.extend({},o,et,lt(),u)}function lt(){var t={};return n.each(s,function(n,i){var r="bts-"+i+"";l.is("[data-"+r+"]")&&(t[n]=l.data(r))}),t}function at(t){h=n.extend({},h,t)}function vt(){c={down:n(".bootstrap-touchspin-down",l),up:n(".bootstrap-touchspin-up",l),input:n("input",l)}}function yt(){c.input.on("keydown",function(n){var t=n.keyCode||n.which;t===38?(v!=="up"&&(p(),g()),n.preventDefault()):t===40&&(v!=="down"&&(w(),d()),n.preventDefault())});c.input.on("keyup",function(n){var t=n.keyCode||n.which;t===38?y():t===40&&y()});c.input.on("blur",function(){k()});c.down.on("keydown",function(n){var t=n.keyCode||n.which;(t===32||t===13)&&(v!=="down"&&(w(),d()),n.preventDefault())});c.down.on("keyup",function(n){var t=n.keyCode||n.which;(t===32||t===13)&&y()});c.up.on("keydown",function(n){var t=n.keyCode||n.which;(t===32||t===13)&&(v!=="up"&&(p(),g()),n.preventDefault())});c.up.on("keyup",function(n){var t=n.keyCode||n.which;(t===32||t===13)&&y()});c.down.on("mousedown.touchspin",function(n){(c.down.off("touchstart.touchspin"),c.input.is(":disabled"))||(w(),d(),n.preventDefault(),n.stopPropagation())});c.down.on("touchstart.touchspin",function(n){(c.down.off("mousedown.touchspin"),c.input.is(":disabled"))||(w(),d(),n.preventDefault(),n.stopPropagation())});c.up.on("mousedown.touchspin",function(n){(c.up.off("touchstart.touchspin"),c.input.is(":disabled"))||(p(),g(),n.preventDefault(),n.stopPropagation())});c.up.on("touchstart.touchspin",function(n){(c.up.off("mousedown.touchspin"),c.input.is(":disabled"))||(p(),g(),n.preventDefault(),n.stopPropagation())});c.up.on("mouseout touchleave touchend touchcancel",function(n){v&&(n.stopPropagation(),y())});c.down.on("mouseout touchleave touchend touchcancel",function(n){v&&(n.stopPropagation(),y())});c.down.on("mousemove touchmove",function(n){v&&(n.stopPropagation(),n.preventDefault())});c.up.on("mousemove touchmove",function(n){v&&(n.stopPropagation(),n.preventDefault())});n(document).on(r(["mouseup","touchend","touchcancel"],i).join(" "),function(n){v&&(n.preventDefault(),y())});n(document).on(r(["mousemove","touchmove","scroll","scrollstart"],i).join(" "),function(n){v&&(n.preventDefault(),y())});c.input.on("mousewheel DOMMouseScroll",function(n){if(h.mousewheel&&c.input.is(":focus")){var t=n.originalEvent.wheelDelta||-n.originalEvent.deltaY||-n.originalEvent.detail;n.stopPropagation();n.preventDefault();t<0?w():p()}})}function pt(){l.on("touchspin.uponce",function(){y();p()});l.on("touchspin.downonce",function(){y();w()});l.on("touchspin.startupspin",function(){g()});l.on("touchspin.startdownspin",function(){d()});l.on("touchspin.stopspin",function(){y()});l.on("touchspin.updatesettings",function(n,t){ht(t)});l.on("touchspin.updateText",function(n){c.input.val(n.text)});l.on("touchspin.updateVal",function(n){t=n.value;c.input.val(n.text)})}function wt(n){switch(h.forcestepdivisibility){case"round":return(Math.round(n/h.step)*h.step).toFixed(h.decimals);case"floor":return(Math.floor(n/h.step)*h.step).toFixed(h.decimals);case"ceil":return(Math.ceil(n/h.step)*h.step).toFixed(h.decimals);default:return n}}function k(){var r,n,i;if(r=t,r===""){h.replacementval!==""&&(t=h.replacementval,nt());return}h.decimals>0&&r==="."||(n=parseFloat(r),isNaN(n)&&(n=h.replacementval!==""?h.replacementval:0),i=n,n.toString()!==r&&(i=n),n<h.min&&(i=h.min),n>h.max&&(i=h.max),i=wt(i),Number(r).toString()!==i.toString()&&nt())}function ft(){if(h.booster){var n=Math.pow(2,Math.floor(b/h.boostat))*h.step;return h.maxboostedstep&&n>h.maxboostedstep&&(n=h.maxboostedstep,a=Math.round(a/n)*n),Math.max(h.step,n)}return h.step}function p(){k();a=parseFloat(t);isNaN(a)&&(a=0);var n=a,i=ft();a=a+i;a>h.max&&(a=h.max,l.trigger("touchspin.on.max"),y());t=Number(a).toFixed(h.decimals);n!==a&&nt()}function w(){k();a=parseFloat(t);isNaN(a)&&(a=0);var n=a,i=ft();a=a-i;a<h.min&&(a=h.min,l.trigger("touchspin.on.min"),y());t=a.toFixed(h.decimals);n!==a&&nt()}function d(){y();b=0;v="down";l.trigger("touchspin.on.startspin");l.trigger("touchspin.on.startdownspin");rt=setTimeout(function(){tt=setInterval(function(){b++;w()},h.stepinterval)},h.stepintervaldelay)}function g(){y();b=0;v="up";l.trigger("touchspin.on.startspin");l.trigger("touchspin.on.startupspin");ut=setTimeout(function(){it=setInterval(function(){b++;p()},h.stepinterval)},h.stepintervaldelay)}function y(){clearTimeout(rt);clearTimeout(ut);clearInterval(tt);clearInterval(it);switch(v){case"up":l.trigger("touchspin.on.stopupspin");l.trigger("touchspin.on.stopspin");break;case"down":l.trigger("touchspin.on.stopdownspin");l.trigger("touchspin.on.stopspin")}b=0;v=!1;bt()}function nt(){n.isFunction(f)?f(t):c.input.val(t)}function bt(){n.isFunction(e)&&setTimeout(function(){v||e(t)},500)}var h,l=n(this),et=l.data(),c,a,tt,it,rt,ut,b=0,v=!1;ot()})}})(jQuery);